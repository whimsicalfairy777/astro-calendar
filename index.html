<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Astro Calendar</title>
  <link href="https://fonts.googleapis.com/css2?family=UnifrakturMaguntia&display=swap" rel="stylesheet"/>
  <style>
    body { font-family:'UnifrakturMaguntia',cursive; background:#EEF3ED; text-align:center; padding:20px; overflow:hidden; color:#303328; }
    .calendar-container { background:#EEF3ED; border:1px solid #9C816E; padding:20px; display:inline-block; box-shadow:5px 5px 15px rgba(0,0,0,0.1); }
    h1 { margin:0 0 10px; background:#D1C9BD; color:#9C816E; border:1px solid #9C816E; display:inline-block; font-size:32px; }
    .calendar { display:grid; grid-template-columns:repeat(7,40px); grid-gap:5px; justify-content:center; margin-bottom:15px; }
    .calendar div { width:40px; height:20px; line-height:20px; cursor:pointer; color:#303328; background:#F3EEEE; border:1px solid #D1C9BD; transition:all .2s; }
    .calendar .header { font-weight:bold; background:#D1C9BD; }
    .calendar div:hover { background:rgba(48,51,40,0.1); border-color:#303328; }
    .calendar .today { background:rgba(48,51,40,0.2); border-color:#303328; }
    #eventSummary { font-size:20px; padding:10px; background:#D1C9BD; border:1px solid #9C816E; display:inline-block; text-align:left; min-width:300px; max-width:90vw; color:#303328; }
    .star { 
      position: absolute;
      color: #ffffff;
      animation: floatStars linear infinite;
      z-index: 0;
      opacity: 0.7;
      font-size: 16px;
      text-shadow: 0 0 6px rgba(255, 255, 255, 0.8);
    }
    @keyframes floatStars { 0% { 
        transform: translateY(-50px) rotate(0deg) scale(0.5); 
        opacity: 0; 
      }
      10% { 
        opacity: 0.7; 
      }
      90% { 
        opacity: 0.5; 
      }
      100% { 
        transform: translateY(100vh) rotate(360deg) scale(1.2); 
        opacity: 0; 
      }
    }
    
    .star-field {
      position: fixed;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      pointer-events: none;
      z-index: 0;
      overflow: hidden;
    }
    .month-nav { display:flex; justify-content:center; align-items:center; margin-bottom:15px; }
    .nav-btn { background:#D1C9BD; border:1px solid #9C816E; cursor:pointer; width:40px; height:40px; font-size:20px; color:#303328; margin:0 10px; }
    #currentMonthYear { margin:0 15px; font-size:24px; min-width:200px; }
  </style>
</head>
<body>
  <div class="calendar-container">
    <h1>✦ Astro Calendar ✦</h1>
    <div class="month-nav">
      <button class="nav-btn" onclick="changeMonth(-1)">❮</button>
      <div id="currentMonthYear">January 2025</div>
      <button class="nav-btn" onclick="changeMonth(1)">❯</button>
    </div>
    <div id="calendar" class="calendar"></div>
    <div id="eventSummary">Click any date to see astrological events</div>
    <div class="footer">
      ✦ Seek harmony with the cosmos and wisdom will follow ✦
    </div>
  </div>
  <script>
    let events = [];
    let currentDate = new Date(); // Tracks currently displayed month/year
    currentDate.setDate(1); // Ensure we're at start of month
    
    // Load enriched events
    fetch('enriched_events.json')
      .then(r => r.json())
      .then(data => {
        events = data;
        buildCalendar(currentDate.getFullYear(), currentDate.getMonth());
      });

    function buildCalendar(year, month) {
      const cal = document.getElementById('calendar');
      cal.innerHTML = '';
      
      // Set month/year header
      const monthNames = ["January", "February", "March", "April", "May", "June",
                         "July", "August", "September", "October", "November", "December"];
      document.getElementById('currentMonthYear').textContent = 
        `${monthNames[month]} ${year}`;
      
      // Create weekday headers
      ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'].forEach(d => { 
        const h = document.createElement('div'); 
        h.textContent = d; 
        h.classList.add('header'); 
        cal.appendChild(h); 
      });
      
      // Calculate calendar dates
      const first = new Date(year, month, 1).getDay();
      const days = new Date(year, month + 1, 0).getDate();
      const today = new Date();
      const todayStr = today.toISOString().slice(0,10);
      
      // Add empty cells for days before first day of month
      for(let i = 0; i < first; i++) {
        cal.appendChild(document.createElement('div'));
      }
      
      // Create day cells
      for(let d = 1; d <= days; d++) {
        const dtStr = `${year}-${String(month + 1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
        const cell = document.createElement('div'); 
        cell.textContent = d;
        
        // Highlight today
        if(dtStr === todayStr) cell.classList.add('today');
        
        // Add event indicators
        const dayEvents = events.filter(e => e.datetime.slice(0,10) === dtStr);
        if(dayEvents.length > 0) {
          cell.innerHTML = `${d}<br><span style="font-size:8px">✦${dayEvents.length}</span>`;
        }
        
        // Click handler
        cell.onclick = () => showEvents(dtStr);
        cal.appendChild(cell);
      }
    }
    
    function showEvents(dateStr) {
      const sum = document.getElementById('eventSummary');
      const dayEvents = events.filter(e => e.datetime.slice(0,10) === dateStr);
      
      if(dayEvents.length === 0) {
        sum.innerHTML = `<strong>${dateStr}</strong><br>No astrological events recorded`;
        return;
      }
      
      let html = `<strong>${dateStr}</strong>`;
      dayEvents.forEach(event => {
        html += `
          <div style="margin-top:10px">
            <strong>✦ ${event.event}</strong><br>
            <em>Meaning:</em> ${event.meaning}<br>
            <em>Advice:</em> ${event.advice}
          </div>
        `;
      });
      
      sum.innerHTML = html;
    }
    
    function changeMonth(offset) {
      currentDate.setMonth(currentDate.getMonth() + offset);
      buildCalendar(currentDate.getFullYear(), currentDate.getMonth());
      document.getElementById('eventSummary').innerHTML = 
        `Showing ${document.getElementById('currentMonthYear').textContent}`;
    }
    
    function createStar() { 
      const s = document.createElement('div'); 
      s.className = 'star'; 
      s.textContent = '✦'; 
      s.style.fontSize = Math.random()*16+8+'px'; 
      s.style.left = Math.random()*100+'vw'; 
      s.style.animationDuration = Math.random()*3+2+'s'; 
      document.body.appendChild(s); 
      setTimeout(()=>s.remove(),5000); 
    }
    setInterval(createStar, 300);
  </script>
</body>
</html>
