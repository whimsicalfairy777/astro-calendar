<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>✦ Astro Calendar ✦</title>
  <link href="https://fonts.googleapis.com/css2?family=UnifrakturMaguntia&display=swap" rel="stylesheet"/>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'UnifrakturMaguntia', cursive; 
      background: #EEF3ED; 
      text-align: center; 
      padding: 20px; 
      overflow: hidden; 
      color: #303328;
      position: relative;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    
    .calendar-container { 
      background: #EEF3ED; 
      border: 1px solid #9C816E; 
      padding: 15px 20px 20px; 
      display: inline-block; 
      box-shadow: 5px 5px 15px rgba(0,0,0,0.1); 
      position: relative;
      z-index: 10;
      max-width: 95vw;
      min-width: 350px;
    }
    
    h1 { 
      margin: 0 0 15px; 
      background: #D1C9BD; 
      color: #303328; 
      padding: 10px 25px; 
      border: 1px solid #9C816E; 
      display: inline-block; 
      font-size: 28px; 
      letter-spacing: 2px;
    }
    
    .calendar { 
      display: grid; 
      grid-template-columns: repeat(7, 38px); 
      grid-gap: 3px; 
      justify-content: center; 
      margin-bottom: 15px; 
    }
    
    .calendar div { 
      width: 38px; 
      height: 20px; 
      line-height: 20px; 
      cursor: pointer; 
      color: #303328; 
      background: #F3EEEE; 
      border: 1px solid #9C816E; 
      transition: all .2s; 
      font-size: 14px;
      position: relative;
    }
    
    .calendar .header { 
      font-weight: bold; 
      background: #D1C9BD; 
      font-size: 13px;
    }
    
    .calendar div:hover { 
      background: rgba(48,51,40,0.1); 
      border-color: #303328; 
    }
    
    .calendar .today { 
      background: rgba(48,51,40,0.2); 
      border-color: #303328; 
    }
    
    #eventSummary { 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      font-size: 16px; 
      padding: 15px; 
      background: #D1C9BD; 
      border: 1px solid #9C816E; 
      display: inline-block; 
      text-align: left; 
      min-width: 300px; 
      max-width: 90vw; 
      color: #303328; 
      line-height: 1.5;
      border-radius: 3px;
    }
    
    .event-date {
      font-family: 'UnifrakturMaguntia', cursive;
      font-size: 20px;
      display: block;
      margin-bottom: 10px;
      text-align: center;
      padding-bottom: 5px;
      border-bottom: 1px dashed #9C816E;
    }
    
    .star { 
      position: absolute; 
      color: #fff; 
      animation: floatStars linear infinite;
      opacity: 0;
      pointer-events: none;
      z-index: 1;
      text-shadow: 0 0 5px rgba(255,255,255,0.5);
    }
    
    @keyframes floatStars {
      0% {
        transform: translateY(100vh) translateX(0) rotate(0deg);
        opacity: 0;
      }
      10% {
        opacity: 0.7;
      }
      90% {
        opacity: 0.7;
      }
      100% {
        transform: translateY(-20vh) translateX(20px) rotate(180deg);
        opacity: 0;
      }
    }
    
    .month-nav { 
      display: flex; 
      justify-content: center; 
      align-items: center; 
      margin-bottom: 15px; 
    }
    
    .nav-btn { 
      background: #D1C9BD; 
      border: 1px solid #9C816E; 
      cursor: pointer; 
      width: 34px; 
      height: 34px; 
      font-size: 16px; 
      color: #303328; 
      margin: 0 10px; 
      border-radius: 3px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s;
    }
    
    .nav-btn:hover {
      background: rgba(48,51,40,0.1);
    }
    
    #currentMonthYear { 
      margin: 0 15px; 
      font-size: 22px; 
      min-width: 200px; 
      letter-spacing: 1px;
    }
    
    .event-indicator {
      position: absolute;
      top: 1px;
      right: 2px;
      font-size: 9px;
      color: #9C816E;
    }
    
    .event-detail {
      margin-top: 12px;
      padding: 8px;
      background: rgba(255,255,255,0.3);
      border-radius: 3px;
    }
    
    .loading {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      text-align: center;
      padding: 20px;
    }
  </style>
</head>
<body>
  <div class="calendar-container">
    <h1>✦ Astro Calendar ✦</h1>
    <div class="month-nav">
      <button class="nav-btn" onclick="changeMonth(-1)">❮</button>
      <div id="currentMonthYear">January 2025</div>
      <button class="nav-btn" onclick="changeMonth(1)">❯</button>
    </div>
    <div id="calendar" class="calendar"></div>
    <div id="eventSummary">Loading astrological events...</div>
  </div>
  
  <script>
    let events = [];
    let currentDate = new Date();
    currentDate.setDate(1);
    
    // Load events from enriched_events.json
    function loadEvents() {
      fetch('enriched_events.json')
        .then(response => {
          if (!response.ok) {
            throw new Error('Failed to load events');
          }
          return response.json();
        })
        .then(data => {
          events = data;
          buildCalendar(currentDate.getFullYear(), currentDate.getMonth());
          document.getElementById('eventSummary').innerHTML = 
            'Select a date to view astrological events';
        })
        .catch(error => {
          console.error('Error loading events:', error);
          document.getElementById('eventSummary').innerHTML = 
            'Error loading events. Using sample data instead.';
          // Fallback to sample data
          events = getSampleEvents();
          buildCalendar(currentDate.getFullYear(), currentDate.getMonth());
        });
    }
    
    // Sample events for demonstration if JSON fails
    function getSampleEvents() {
      const today = new Date();
      const year = today.getFullYear();
      const month = today.getMonth() + 1;
      
      return [
        {
          "datetime": `${year}-${month.toString().padStart(2,'0')}-05T00:00:00`,
          "event": "Full Moon in Cancer",
          "meaning": "A time for emotional reflection and nurturing relationships.",
          "advice": "Focus on family and close relationships. Trust your intuition."
        },
        {
          "datetime": `${year}-${month.toString().padStart(2,'0')}-12T00:00:00`,
          "event": "Mercury enters Capricorn",
          "meaning": "Communication becomes more structured and practical.",
          "advice": "Focus on long-term plans and professional communications."
        },
        {
          "datetime": `${year}-${month.toString().padStart(2,'0')}-20T00:00:00`,
          "event": "Sun enters Aquarius",
          "meaning": "A shift toward innovation, community, and forward-thinking.",
          "advice": "Embrace your uniqueness and connect with like-minded people."
        },
        {
          "datetime": `${year}-${month.toString().padStart(2,'0')}-28T00:00:00`,
          "event": "New Moon in Aquarius",
          "meaning": "A powerful time for setting intentions around innovation.",
          "advice": "Set goals related to technology, social causes, or personal freedom."
        }
      ];
    }
    
    function buildCalendar(year, month) {
      const cal = document.getElementById('calendar');
      cal.innerHTML = '';
      
      const monthNames = ["January", "February", "March", "April", "May", "June",
                         "July", "August", "September", "October", "November", "December"];
      document.getElementById('currentMonthYear').textContent = 
        `${monthNames[month]} ${year}`;
      
      // Weekday headers (single letter)
      ['S','M','T','W','T','F','S'].forEach(d => { 
        const h = document.createElement('div'); 
        h.textContent = d; 
        h.classList.add('header'); 
        cal.appendChild(h); 
      });
      
      const first = new Date(year, month, 1).getDay();
      const days = new Date(year, month + 1, 0).getDate();
      const today = new Date();
      const todayStr = today.toISOString().slice(0,10);
      
      for(let i = 0; i < first; i++) {
        cal.appendChild(document.createElement('div'));
      }
      
      for(let d = 1; d <= days; d++) {
        const dtStr = `${year}-${String(month + 1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
        const cell = document.createElement('div'); 
        cell.textContent = d;
        
        if(dtStr === todayStr) cell.classList.add('today');
        
        const dayEvents = events.filter(e => e.datetime.slice(0,10) === dtStr);
        if(dayEvents.length > 0) {
          const indicator = document.createElement('span');
          indicator.className = 'event-indicator';
          indicator.textContent = '✦';
          cell.appendChild(indicator);
        }
        
        cell.onclick = () => showEvents(dtStr);
        cal.appendChild(cell);
      }
    }
    
    function showEvents(dateStr) {
      const sum = document.getElementById('eventSummary');
      const dayEvents = events.filter(e => e.datetime.slice(0,10) === dateStr);
      
      if(dayEvents.length === 0) {
        sum.innerHTML = `<span class="event-date">${formatDate(dateStr)}</span>No astrological events recorded for this date`;
        return;
      }
      
      let html = `<span class="event-date">${formatDate(dateStr)}</span>`;
      dayEvents.forEach(event => {
        html += `
          <div class="event-detail">
            <strong>✦ ${event.event}</strong><br>
            <em>Meaning:</em> ${event.meaning}<br>
            <em>Advice:</em> ${event.advice}
          </div>
        `;
      });
      
      sum.innerHTML = html;
    }
    
    function formatDate(dateStr) {
      const date = new Date(dateStr);
      return date.toLocaleDateString('en-US', { 
        weekday: 'long', 
        month: 'long', 
        day: 'numeric', 
        year: 'numeric' 
      });
    }
    
    function changeMonth(offset) {
      currentDate.setMonth(currentDate.getMonth() + offset);
      buildCalendar(currentDate.getFullYear(), currentDate.getMonth());
      document.getElementById('eventSummary').innerHTML = 
        `Showing ${document.getElementById('currentMonthYear').textContent}`;
    }
    
    function createStar() { 
      const s = document.createElement('div'); 
      s.className = 'star'; 
      s.textContent = '✦'; 
      s.style.fontSize = Math.random()*12+6+'px'; 
      s.style.left = Math.random()*100+'vw'; 
      const duration = Math.random()*8+4;
      s.style.animation = `floatStars ${duration}s linear`;
      s.style.animationDelay = Math.random()*2 + 's';
      document.body.appendChild(s); 
      setTimeout(()=>s.remove(), (duration+2)*1000); 
    }
    
    // Initialize the calendar
    loadEvents();
    
    // Create initial stars
    for (let i = 0; i < 30; i++) {
      setTimeout(() => createStar(), Math.random() * 3000);
    }
    setInterval(createStar, 1000);
  </script>
</body>
</html>
